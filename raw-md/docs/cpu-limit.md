---
title: 有關 CPU 限制
---

Screeps 游戲引擎有兩種運行模式：一種是基於瀏覽器的**單機模式**，比如主頁上的 [sim](https://screeps.com/a/#!/sim) 。另一種是基於服務器的**聯機模式**。盡管兩種模式以游戲的角度看來沒有差別的，且所能調用的 api 都是一模一樣的，但執行玩家代碼的方法不同。單機模式下，代碼都是由瀏覽器本地執行的，並不需要任何雲端服務器的參與。

而在聯機模式下，代碼的執行完全由雲端的服務器負責而非本地瀏覽器，為了方便管理，我們提供了名為 CPU 時間的資源，您可以由此使用游戲服務器上的 CPU 資源。

在[理解游戲循環、游戲時間、 ticks](/game-loop.html) 中，我們提過這個游戲是由很多 tick 構成的。每一 tick ，游戲引擎會執行所有玩家的代碼。但 tick 的時長並不固定的——只有當所有玩家的代碼被執行後，服務器才會結束這 tick。

## CPU 限制

為了避免玩家的代碼執行時間過長而影響游戲的流暢性，我們引入了 **CPU 限額**。其本質是以毫秒為單位來限制代碼執行時長， 100 CPU 意味著玩家的代碼最多可以執行 100 毫秒，當 100 毫秒到後，無論代碼是否執行完全都會被強行終止。玩家默認有 20 CPU ，但可通過[訂閱](/subscription.html)增加 CPU ，具體增量跟玩家的 [GCL](/control.html) 掛鉤。

## 庫存

方便起見，玩家每 tick 所省下的 CPU 會被存在 `bucket` 中以備不時之需。這樣，玩家仍可執行超過其 CPU 限制的代碼。

![](#cpu-bucket.webp)

如果玩家的代碼在 CPU 限制內執行完了，那麼其剩余的 CPU 便會被存起來。玩家最多可以存 10,000 CPU ，但每 tick 最多可用 500 CPU 。

舉例來說，如果玩家的 CPU 限制為 150，但其代碼每 tick 只要 100 CPU 就執行完了，那麼剩下的 50 CPU 則會被存在 `bucket` 中。因此，用省下的 CPU ，玩家可以每 5 tick 執行一個需要 250 CPU 的大型代碼，或每 200 tick 連續執行五個各需要 500 CPU 的超大型代碼。

[`Game.cpu.tickLimit`](/api/#Game.cpu) 便為玩家此 tick  最多使用的 CPU 量。當玩家的 [`Game.cpu.bucket`](/api/#Game.cpu) 存滿了後， [`Game.cpu.tickLimit`](/api/#Game.cpu) 便為上限 500 。這個最多多用量只會在玩家 [`Game.cpu.bucket`](/api/#Game.cpu) 快見底後減少，且 [`Game.cpu.tickLimit`](/api/#Game.cpu) 永遠不會小於你的 CPU 限制 （[`Game.cpu.limit`](/api/#Game.cpu)）


因此，玩家根據 CPU 儲量，可以保證其需要消耗大量時間的代碼（比如尋路代碼）不被中斷。
